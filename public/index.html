<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" type="text/css" href="css/bootstrap-grid.css">
        <link rel="stylesheet" type="text/css" href="css/bootstrap.css">
        <link rel="stylesheet" type="text/css" href="css/style.css">
        
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script type="text/javascript" src="js/bootstrap.js"></script>
        <script type="text/javascript" src="js/socket.js"></script>
        <script type="text/javascript" src="js/api.js"></script>
        
        <title>Best Seats</title>
    </head>
    <body>
  
        <script>
            
            function reservetimout(region){
                API.setTableState(region, 0);
                
            }
            
            
            
            
            
            var xpos;
            var ypos;
            var ID;
            var state;
            var passreserve;
            
            API.onTableUpdate(function(tables) {
                        $('.tableimg').remove();
                                tables.forEach(function(table) {
                                    xpos = table.x;
                                    ypos = table.y;
                                    ID = table.region;
                                    var state = table.state;
                            var element = $("<li class='tableimg' id='" + ID + "' width='100px'></li>");

                            element.appendTo("#rightbody");
                                    if(state == 1){
                                      element.css({
                                        "backgroundImage" : "url(../img/tableyellow.png)",
                                    "left" : (xpos - 50),
                                    "top" : (ypos - 50)
                                });  
                                    }
                                    else if (state == 2) {
                                        element.css({
                                        "backgroundImage" : "url(../img/tablered.png)",
                                    "left" : (xpos - 50),
                                    "top" : (ypos - 50)
                                    });
                                    }
                                                
                                    else {
                            element.css({

                                    "left" : (xpos - 50),
                                    "top" : (ypos - 50)
                                });
                                         }
                            element.attr('id', ID);
                    element.click(function() {
                    var elemID;
                    if(passreserve == true){
                        elemID = $(this).prop("id");
                        
                        if(state == 2) {
                            alert("This table is taken");
                            $("#table").fadeOut(300);
                            $("#tablereserve").fadeOut(300);
                        }
                        else {
                            $("#" + elemID).css({
                                "backgroundImage" : "url(../img/tableyellow.png)"
                            });
                            API.setTableState(elemID, 1);
                            setTimeout(function() {
                                reservetimout(elemID);
                            }, 4000)
                            $("#table").fadeOut(300);
                            $("#tablereserve").fadeOut(300);
                        }
                    }
                    passreserve = false;
                    })       
                });
                });
        
            
            
       
            
            API.getDevices(function(devices) {
                devices.forEach(function(tableinfo) {
                    
                    API.setTableState(tableinfo.beacon, 2);
                    
                });
            });
            
            
            
            
            
        </script>
        
        <div class="container">
            <div class="row">
                <div class="col-lg-3" id="menubody">
                    <h1 id="header">Best Seats</h1>
                    <hr>
                    <button class="button" id="reserve">Reserve Tables</button>
                    
                    <button id="storelogin" class="button">Store Login</button>
                </div>
                <div id="rightbodycontainer">
                    <div class="col-lg-9 scroll" id="rightbody">
                        <br>
                        <p id="table" style="display: none">Please Select a Table</p>
                        <hr id="tablereserve" style="display: none">
                    </div>
                </div>
                <script>
                    $("#table").fadeOut(500);
                    $("#tablereserve").fadeOut(500);
                        $("#storelogin").click(function() {
          
                                window.location.replace("store.html")
    
                        });
                    
                        $("#reserve").click(function() {
                           
                                $("#table").fadeIn(300);
                                $("#tablereserve").fadeIn(300);
                              
                                
                            passreserve = true;
                        });
                        
                    
                    
                    
                    </script>
                
            </div>
        </div>
    </body>
</html>